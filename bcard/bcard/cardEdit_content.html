<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
    <head>
        <title></title>
        <meta charset="utf-8">
        <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <link rel="stylesheet" href="css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.icon.css">
        <link rel="stylesheet" href="css/appcan.control.css">
        <link rel="stylesheet" href="css/ai-base-ui.css">
        <link rel="stylesheet" href="css/ai-color.css">
        <link rel="stylesheet" href="css/ai-control.css">
        <link rel="stylesheet" href="css/style.css">
       <link rel="stylesheet" href="css/main.css">
    </head>
    <style>
        html, body {
           -webkit-user-select:none; 
           user-select:none;
           -webkit-touch-callout:none; 
        }
       .hd{ z-index:1;  text-align: center; }
       .hd li{display:inline-block; width:1.65em; height:0.187em; background:#e28191; text-indent:-9999px; overflow:hidden; margin:0 6px;}
       .hd li.on{ background:#d5132d;  }
       .user-font{font-family: "宋体";font-weight: bolder;}
    </style>
      <body class="um-vp bc-bg" id="zoom"  ontouchstart>
         
            <!-- slideBox -->
             <div class="ai-pat-default v_s_container" id="main_body">
               <form id="addForm">
                   <!-- <div style="position: relative;">
                        <div id="slideBox" class="slideBox">
                        <div class="bd" >
                            <ul id="bannerList" >
                                   <li class="banner_li">
                                      <a class="pic"><img src=""  id="img_model"/></a>
                                       <span id="span_1" class="" >
                                        <div style="position: absolute;top:44.25%;left:75.7062%;right: 6.867%;width: 21%" id="img_1111" class="uhide">
                                            <img src="images/appcan_opp.png" style="width: 100%"  id=""/>
                                        </div> 
                                        
                                  
                                        </span> 
                                    </li>
                                     <li >
                                      <a class="pic"><img src="" id="bg_img"/></a>
                                    </li> 
                            </ul>
                        </div>
        
                        <div class="hd">
                            <ul></ul>
                        </div>
                    </div>
                   
                  </div> -->
               <div id="uploadresult" class="uhide" style="margin-top:0px;"> 
                  <img src="images/loading_2.gif" alt="正在请求，请稍后..." style="min-width:2em"/>
                </div>
                <!-- <div id="uploadresult_1" class="uhide" style="width: 11em;left: 34%;margin: 0 auto;margin-top: 50%;position: absolute;z-index: 10;"> 
                      <img src="images/loading_1.gif" alt="正在请求，请稍后..." style="float:left;" />
                      <div class="logss" style="float: left;margin-left: 0.5em;margin-top: 0.7em;line-height: 1em;font-size: 0.875em">正在提交，请稍后...</div>
                 </div> -->
                  <div id="uploadresult_1" class="ub ub-ac ub-pc uhide" style="z-index: 10;position: absolute;top:10%;left:30%;background-color:white"> 
                      
                          <div>
                              <img src="images/loading_2.gif" alt="正在请求，请稍后..." style="min-width:2em" />
                          </div>
                          <div>
                              <div class="logss" style="line-height: 1em;font-size: 0.875em">正在提交，请稍后...</div>
                          </div>
                 </div>
                <div style="clear:both;"></div>
                 <div id="slider" class="slider">
                      
                  </div>
                    <div class="hd" id="hd">
                        <ul class=""><li class="on">1</li><li class="">2</li></ul>
                    </div>


                <div class="edit_card_text ai-ph-display ai-ubt he">基本信息</div>
                <div class="card_1 ai-us">
                    <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">名片名称</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                  <input type="hidden" id="_id" name="bcardId"  value="" />
                                <input type="hidden" id="templateId" name="templateId"  value="" />
                                 <input type="hidden" id="templateEnName" name="templateEnName" class="uhide" value="" />
                                <input placeholder="请输入名片名称" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common display_1 required"  name="bcardName" id="bcardName"  value=""  >
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">姓名中文</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入姓名中文" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="userName" id="userName" value=""   oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="姓名中文格式不正确">
                                <!--input placeholder="请输入姓名中文" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="userName" id="userName" value=""   oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="姓名中文格式不正确" regex="^([\u4e00-\u9fa5]){2,7}$"-->
                            </div>
                             <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                    </div>
                    <div class=" jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed uhide">
                            <div class=" jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">公司名称</div>
                            <div class="jc_dbtd_1_left jc_flex_1 ">
                                <div class="select uba bc-border bc-text select_all">
                                    <div class="text select_text ai-fts-body">请选择</div>
                                    <div class=" ub-img select_xia"style="float:right "></div>
                                    <select class="" placeholder="请选择公司" name="company" id="company_select">
                                        
                                    </select>
                                </div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed uhide" id="">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">公司名称</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入公司名称" type="text" class="ai-fts-body bor0 tx-l ai-ph-common" name="company" id="company" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                            <div class="yingc uhide color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                           
                     </div>
                      <div class="jc_flex pa_t7 pa_b7 jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">部门</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入部门" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common department" name="dept" id="dept" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                             
                     </div>
                    
                </div>
                <div class="edit_card_text ai-ph-display">更多</div>
             <div class="card_1 ai-us" id="more_info_2">
                     <div class="jc_flex pa_t7 pa_b7  bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">职位</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入职位" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="job" id="job" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                           
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">手机号码</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入手机号码" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="mobileNumber" id="mobileNumber" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="手机号码格式不正确">
                                <!--input placeholder="请输入手机号码" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="mobileNumber" id="mobileNumber" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="手机号码格式不正确" regex="^0?1[3|4|5|8][0-9]\d{8}$"-->
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                          
                     </div>
                      <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">公司地址</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入公司地址" type="text" class="ai-fts-body bor0 tx-l ai-ph-common" name="companyAddress" id="companyAddress" value=""  oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                           <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">邮箱</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入邮箱" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="email" id="email"  value="" errorMsg="邮箱格式不正确"  oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                                <!--input placeholder="请输入邮箱" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="email" id="email"  value="" errorMsg="邮箱格式不正确" regex="^[A-Za-z0-9]+([._\\-]*[A-Za-z0-9])*@([A-Za-z0-9]+[-A-Za-z0-9]*[A-Za-z0-9]+.){1,63}[A-Za-z0-9]+$" oninput="copyByInput(this)" onpropertychange="copyByInput(this)"-->
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">邮编</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入邮编号" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="postcode" id="postcode" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="邮编格式不正确">
                                <!--input placeholder="请输入邮编号" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="postcode" id="postcode" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="邮编格式不正确" regex="^[1-9][0-9]{5}$"-->
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                         
                     </div>
                      <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">电话号码</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入电话号码" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="call" id="call" value=""  oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                            
                     </div>
                      <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">传真</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入传真" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="fax" id="fax" value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">公司主页</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入公司主页" type="text"  class="ai-fts-body bor0 tx-l ai-ph-common" name="companyPage" id="companyPage"  value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)"  >
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">QQ</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入QQ号" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="QQ" id="QQ"  value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="QQ格式不正确">
                                <!--input placeholder="请输入QQ号" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="QQ" id="QQ"  value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="QQ格式不正确" regex="^[1-9][0-9]{4,9}$"-->
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                      <div class="jc_flex pa_t7 pa_b7 bor_db jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">微信</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入微信号" type="text" class="ai-fts-body bor0 tx-l ai-ph-common" name="weixin" id="weixin"  value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="微信格式不正确">
                                <!--input placeholder="请输入微信号" type="tel"  class="ai-fts-body bor0 tx-l ai-ph-common" name="weixin" id="weixin"  value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" errorMsg="微信格式不正确" regex="^[a-zA-Z\d_]{5,}$"-->
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                     <div class="jc_flex pa_t7 pa_b7 jc_dbtd longtap-fixed">
                            <div class="jc_dbtd_left pa_l7 ai-fts-body ai-ph-display">客服电话</div>
                            <div class="jc_dbtd_1_left jc_flex_1 input_2">
                                <input placeholder="请输入客服电话" class="ai-fts-body bor0 tx-l ai-ph-common" name="servicePhone" id="servicePhone"  value="" oninput="copyByInput(this)" onpropertychange="copyByInput(this)" data-display="1">
                            </div>
                            <div class="yingc color_1_2 uhide">
                                  <div class="ying_z ai-fts-caption">显示</div>
                            </div>
                     </div>
                   
                    
                </div>
                <div class="ai-card_2">
                 <div class="ai-item" style="padding: 0px">
                   <div class=" ai-btn ai-btn_add ai-btn-block ai-btn-primaiy ai-mab-gap" id="saveBtn" data-action_name="save">保存</div>
                 </div>
               </div>
            </form>    
            </div>
        
       
         <script src="js/appcan.js"></script>
        <script src="js/appcan.control.js"></script>
       <script src="js/appcan.listview.js"></script>
       <script src="js/view/common.js"></script>
       <script src="js/appcan.slider.js"></script>
 </body>
    <script>
     document.documentElement.style.webkitUserSelect="none";
     document.documentElement.style.webkitTouchCallout="none";
       var card_1={};
      //跳转到预览页面
        var slider = appcan.slider({
          selector : '#slider',
          aspectRatio:10/16,
          hasLabel:true,
          index:0
        });
                                   
                                            
        appcan.ready(function() {
            appcan.window.evaluateScript({
                name:'cardEdit',
                scriptContent:'renderW();'
            });
            var userBcardId= appcan.locStorage.getVal('userBcardId');
            //第一个
          //  var userBcardId="56a1f24393f4ad36e6e3af39";
           //第二个模版
           //var userBcardId="56a1f24393f4ad36e6e3af39"
           //第三个模版
          //var userBcardId="56a1f66f93f4ad36e6e3af3a";
           
             //第四个模版
        // var userBcardId="56a31ee093f4ad36e6e3b24f";
            loadBcardInfo(userBcardId);
            appcan.locStorage.setVal('userBcardId_1',userBcardId);
           //渲染模版
           var  userId=appcan.locStorage.getVal('user_id');
            $("#addForm").data("user_id",userId);
             var isinternal=appcan.locStorage.getVal('isinternal');
             $("#addForm").data("is_internal",isinternal);
           $("body").on("tap",function (e){
                  var userId=$("#addForm").data("user_id");
                    //  var   userId=appcan.locStorage.getVal('user_id');
                  var action="";
                   //点击保存按钮
                   if(e.target==$("#saveBtn")[0]){
                    if(validate()==false){
                        return;
                    }else{
                       saveEditCard(action,userId); 
                    }
            }
           //关闭demo浮动窗口
              appcan.window.evaluateScript("","more_close()");
            //uexWindow.closePopover('card_more');
         }); 
        });
       //当输入框输入时，在模版上显示输入的值
       function copyByInput(obj){
           var i=0;
           var k=$("#more_info_2 input").index($("#"+obj.id));
           var maxLength=$("#"+obj.id).attr("maxlength");
           if( $("#"+obj.id).attr("type")=="number"&&$("#"+obj.id+"_1").html()!=null){
                limit(obj,maxLength);//XX字节内
           }
           $("#"+obj.id+"_model").html(obj.value);
          if( $("#"+obj.id).val().length==0){
               $("#"+obj.id+"_1").addClass("uhide");
                if($("#"+obj.id).hasClass("display_1")==true){
                          $("#"+obj.id).removeClass("display_1");
                          $("#"+obj.id).addClass("display_0");
               }else{
                   $("#"+obj.id).addClass("display_0");
               }
               $("#"+obj.id).parent().siblings(".yingc").addClass("uhide");
               $("#"+obj.id).parent().siblings(".yingc").removeClass("color_1_1");
               $("#"+obj.id).parent().siblings(".yingc").addClass("color_1_2");
               $("#"+obj.id).parent().siblings(".yingc").find(".ying_z").html("显示"); 
             
          }else{
              if($("#"+obj.id+"_1").hasClass("uhide")==true){
                  $("#"+obj.id+"_1").removeClass("uhide")
              }
             if($("#"+obj.id).hasClass("required")==false){
                 if($("#"+obj.id).hasClass("display_0")==true){
                  $("#"+obj.id).removeClass("display_0");
                  $("#"+obj.id).addClass("display_1");
                 }else{
                   $("#"+obj.id).addClass("display_1");
                 }
               
               $("#"+obj.id+"_1").removeClass("uhide");
               $("#"+obj.id).parent().siblings(".yingc").removeClass("uhide");
               $("#"+obj.id).parent().siblings(".yingc").removeClass("color_1_2");
               $("#"+obj.id).parent().siblings(".yingc").addClass("color_1_1");
               $("#"+obj.id).parent().siblings(".yingc").find(".ying_z").html("隐藏");               
              }else{
                  if($("#"+obj.id).hasClass("display_0")==true){
                  $("#"+obj.id).removeClass("display_0");
                  $("#"+obj.id).addClass("display_1");
                 }else{
                   $("#"+obj.id).addClass("display_1");
                 } 
              }
          }
       
       }
       
       //查询名片信息
       function loadBcardInfo(userBcardId){
             var option={
                 url : 'bcard/getUserBcardInfo',
                 data:{"userBcardId":userBcardId},
                  beforeSend: function(XMLHttpRequest) {
                  $("#slider").addClass("uhide");
                  $("#uploadresult").removeClass("uhide");
                },
                 success : function(data) {
                  $("#uploadresult").addClass("uhide");
                   $("#slider").removeClass("uhide");
                    var bcard_share_nosave={};
                   bcard_share_nosave.fileurl=data.data.bcardURL;
                   bcard_share_nosave.backgroundURL=data.data.bcardBackgroudURL;
                   appcan.locStorage.setVal('bcard_share_nosave',bcard_share_nosave);
                     if(data.status=="0"){
                         var bcardInfo=data.data;

                        //  appcan.locStorage.setVal('uuid_11',bcardInfo.uuid);
						 window.localStorage.removeItem('uuid_11');
                         window.localStorage.setItem('uuid_11',bcardInfo.uuid);
                          $(".slider").data("bcard_backgroud_url",bcardInfo.bcardBackgroudURL);
                          $.each(bcardInfo,function(name,value_1){
                               if(typeof(value_1)!="object"){
                                  if(name!=company){
                                      //当不是公司字段时
                                    if(value_1!=null){
                                        $("#"+name).val(value_1);
                                       appcan.locStorage.setVal('bcardName_1',$("#bcardName").val());
                                    }
                                  }else{
                                      //当是公司字段时
                                       if(value_1!=null){
                                            $("#company").val(value_1.value);
                                            $("#company_select").siblings(".text").html(value_1.value);
                                       }
                                  }
                                
                              }else{
                                     if(name!='company'){
                                         //当不是公司字段时
                                         if(value_1!=null){
                                             $("#"+name).val(value_1.value);
                                              if(value_1.display=="1"){
                                                  $("#"+name).addClass("display_1");
                                              }else{
                                                   $("#"+name).addClass("display_0");
                                              }
                                         }
                                        // userName
                                  }else{
                                      //当是公司字段时
                                      if(value_1!=null){
                                           if(value_1.display=="1"){
                                            $('[name="company"]').addClass("display_1");
                                          }else if(value_1.display=="0"){
                                              $('[name="company"]').addClass("display_0");
                                          }
                                           $("#company").val(value_1.value);
                                           $("#company_select").siblings(".text").html(value_1.value);
                                           
                                          }
                                  }
                                
                                  
                              }
                              if(name=="templateId"){
                                 
                                     loadBcardTemplate(value_1);
                              }
                          });
                          if($("#userName").val()==""||$("#userName").val()==undefined||$("#userName").val()==null){
                              var userName="";
                              window.localStorage.setItem('userName',userName);
                             // appcan.locStorage.setVal('userName',userName);
                          }else{
                               var userName=$("#userName").val();
                               window.localStorage.setItem('userName',userName);
                               // appcan.locStorage.setVal('userName',userName);
                               
                          }
                         
                     }
               }
            }
            view.ajax(option);
       }
       
       //获取模版
            function loadBcardTemplate(templateId){
               var option={
                 url : 'bcard/getBcardTemplateById',
                 data:{"templateId":templateId},
                 beforeSend: function(XMLHttpRequest) {
                 
                 },
                success : function(data) {
                    if(data.status=="0"){
                        //selectedMaxDisplayCount
                        $("#span_1").data("max_display_count",data.selectedMaxDisplayCount);
                         var data_1=data.data;
                         //设置名片的背景图片
                        slider.set([{
                                    img : data_1.templateURL,
                                    div:'<span id="span_1"><span id="span_2"></span><div style="position: absolute;top:44.25%;left:75.7062%;right: 6.867%;width: 22%" id="img_1111" class="uhide"><img src="images/appcan_opp2.png" style="width: 100%"  id=""/></div> </span>'
                                                         
                                }, {
                                    img :data_1.templateBackgroundURL,
                                    div:''
                                }]);
                         $("#span_1").data("max_select_count",data_1.selectedMaxDisplayCount);
                         var selectedMaxDisplayCount=data_1.selectedMaxDisplayCount;
                        //不是模版上的特有字段，每个模版都包含的字段
                        var startLocConfig=data_1.startLocationConfig;
                        $("#span_1").data("inc_y",startLocConfig.incrementY*100);
                        $("#span_1").data("start_value_x",startLocConfig.startValueX*100);
                        $("#span_1").data("start_text_x",startLocConfig.startTextX*100);
                        $("#span_1").data("start_text_y",startLocConfig.startTextY*100);
                        $("#templateId").val(data_1._id);
                        $("#templateEnName").val(data_1.templateEnName);
                        //字的大小
                        var relative_fontConfig=data_1.fontConfig;
                         $("#span_1").data("font_size",relative_fontConfig.fontSize/ 1063 * $(".ub-img1").width());
                        
                        
                       //不同模版不同的公司显示方式
                       if($("#templateEnName").val()=="second-template.png"||$("#templateEnName").val()=="third-template.png"){
                             if($("#addForm").data("is_internal")=="1"){
                               //内部员工工号有，显示select
                                 var company_html=$("#company_select").siblings(".text").html();
                                   var index= $.inArray(company_html,data_1.companyConfig.data,0);
                                   if(index==-1){
                                       data_1.companyConfig.data.push(company_html);
                                   }
                                  var companyConfig_data=data_1.companyConfig.data;
                                 var  select_val='<option value="">请选择</option>';
                                for(var i in companyConfig_data){
                                 select_val+='<option value="'+i+'">'+companyConfig_data[i]+'</option>';
                           
                                }
               
                                
                                 $("#company_select").html(select_val);
                                
                                $("#company_select").parents(".jc_flex").removeClass("uhide");
                                //当其进行选择时
                                 appcan.select(".select",function(ele,value){
                                   if(value!=""){
                                       if( $("#company_select").hasClass("display_0")==true){
                                           $("#company_select").removeClass("display_0");
                                          $("#company_select").addClass("display_1");
                                       }else{
                                            $("#company_select").addClass("display_1");
                                       }
                                       
                                     var text_1=$('#company_select option[value="'+value+'"]').text();
                                     $("#company_model").html(text_1);
                                   }else{
                                        var text_1="";
                                        if($("#company_select").hasClass("display_1")==true){
                                            $("#company_select").removeClass("display_1");
                                          $("#company_select").addClass("display_0"); 
                                        }else{
                                             $("#company_select").addClass("display_0"); 
                                        }
                                       
                                     $("#company_model").html(text_1);
                                   }
                               });
                           }else if($("#addForm").data("is_internal")=="0"){
                                //外部员工工号有，不显示select
                                 $("#company").parents(".jc_flex").removeClass("uhide");
                                 $("#company").attr("maxlength",20);
                           }
                      }
                        //模版字段
                          var starTextX= $("#span_1").data("start_text_x");
                          var incY=startLocConfig.incrementY*100;
                          var startTextY= startLocConfig.startTextY*100;
                        var requiredItems=data_1.requiredItems;
                        var selectedItems=data_1.selectedItems;
                       
                       var array=new Array();
                       var array_1=new Array();
                       if(data_1.align=="NorthWest"){
                           //模版左对齐
                            for(var i in requiredItems){
                             var each_requiredItem=requiredItems[i];
                               if(each_requiredItem.locateType=="absolute"){
                                   //必须字段的绝对定位
                                  var name=each_requiredItem.key;
                                  if(data_1.templateEnName=="first-template.png"){
                                       if(name=="job"){
                                          var value_left=Number(each_requiredItem.valueX);
                                           $("#span_1").data("job_left",value_left);
                                           
                                       }
                                       
                                   }
                                   var input_val="";
                                     if(name!="company"){
                                          if(name=="userName"){
                                             var userName=$("#userName").val();
                                             if(userName.length==2){
                                                 input_val=userName.substring(0,1)+"　"+userName.substring(1,2);
                                                 // $("#userName_model").html(userName_model);
                                             } 
                                          else{
                                                  input_val=$("#"+name).val(); 
                                              }
                                         }else{
                                              input_val=$("#"+name).val();
                                         }
                                     }else{
                                         if($("#addForm").data("is_internal")=="0"){
                                               input_val=$("#"+name).val();
                                        }else if($("#addForm").data("is_internal")=="1"){
                                           input_val=$("#company_select").siblings(".text").html();
                                        }
                                     }
                                   array.push(name); 
                                   if(name!="company"){
                                         $("#"+name).addClass("required");
                                          $("#"+name).addClass("absolute");
                                           $("#"+name).attr("maxlength",each_requiredItem.maxLength);
                                         if(each_requiredItem.text != ""){
                                           //当text不为空时
                                            var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                            var text_left=Number(each_requiredItem.textX)*100;
                                            var text_top=Number(each_requiredItem.textY)*100;
                                            var html_1='<div style="position: absolute;top:'+text_top+'%;left:'+text_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<span id="'+name+'_model" style="position: absolute">'+input_val+'</span></div>';
                                            $("#span_1").append(html_1);
                                           
                                            
                                        }else{
                                             //当text为空时
                                             //font-family: "宋体";font-weight: bolder;
                                            
                                            var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                            var value_left=Number(each_requiredItem.valueX)*100;
                                            var value_top=Number(each_requiredItem.valueY)*100;
                                            var html_1='<div style="position: absolute;top:'+value_top+'%;left:'+value_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<div id="'+name+'_model">'+input_val+'</div></div>';
                                            $("#span_1").append(html_1);
                                            
                                        }
                                          if(name=="userName"){
                                                 $("#userName_1").addClass("user-font");   
                                           }
                                            if(data_1.templateEnName=="first-template.png"){
                                               if(name=="job"){
                                                   if($("#userName").val().length==2||$("#userName").val().length==3){
                                                        var per_userName_width=$("#userName_model").width()/4;
                                                        var each_width=per_userName_width/$(".ub-img1").width();
                                                        var present_job_left=(Number(each_requiredItem.valueX)-each_width)*100;
                                                      
                                                       $("#job_1").css("left",present_job_left+"%");
                                                   }
                                                   
                                               }
                                               
                                           }
                                   }else{
                                             if($("#addForm").data("is_internal")=="0"){
                                                    $("#company").addClass("required");
                                                    $("#company").addClass("absolute");
                                            }else if($("#addForm").data("is_internal")=="1"){
                                                 $("#company_select").addClass("required");
                                                  $("#company_select").addClass("absolute");
                                             }
                                               if(each_requiredItem.text != ""){
                                               //当text不为空时
                                                var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                                var text_left=Number(each_requiredItem.textX)*100;
                                                var text_top=Number(each_requiredItem.textY)*100;
                                                var html_1='<div style="position: absolute;top:'+text_top+'%;left:'+text_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<span id="'+name+'_model" style="position: absolute">'+input_val+'</span></div>';
                                                $("#span_1").append(html_1);
                                                
                                            }else{
                                                 //当text为空时
                                                var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                                var value_left=Number(each_requiredItem.valueX)*100;
                                                var value_top=Number(each_requiredItem.valueY)*100;
                                                var html_1='<div style="position: absolute;top:'+value_top+'%;left:'+value_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<div id="'+name+'_model">'+input_val+'</div></div>';
                                                $("#span_1").append(html_1);
                                            }
                                   }
                                
                               }else{
                                   //必须字段的相对定位
                                   if(name!="company"){
                                        var name=each_requiredItem.key;
                                        $("#"+name).addClass("required");
                                       $("#"+name).addClass("relative");
                                        $("#"+name).attr("maxlength",each_requiredItem.maxLength);
                                   }else{
                                         if($("#addForm").data("is_internal")=="0"){
                                                $("#company").addClass("required");
                                                $("#company").addClass("relative");  
                                        }else if($("#addForm").data("is_internal")=="1"){
                                             $("#company_select").addClass("required");
                                              $("#company_select").addClass("absolute");
                                            
                                         }
                                   }
                                   
                                   
                                    
                                  
                                   
                               }
                             }
                             for(var j in selectedItems){
                                 var relative_item=selectedItems[j];
                                  var name=relative_item.key;
                                  if(name=="QQ"){
                                      relative_item.text="Q&nbsp;&nbspQ : ";
                                   }
                                   $("#"+name).addClass("relative");
                                   $("#"+name).attr("maxlength",relative_item.maxLength);
                             }
                           refreshLeft(data_1);
                             //非必须，相对定位
                           var arr_w=new Array();
                           //模版左对齐的失去焦点事件
                            $(".relative").on("blur",function (){
                                  refreshLeft(data_1);
                            })
                          //点击显示，隐藏按钮
                           $(".yingc").on("tap",function (){
                               if($(this).hasClass("color_1_1")==true){
                                   //若颜色为蓝色，则点击将其隐藏
                                   $(this).removeClass("color_1_1");
                                   $(this).addClass("color_1_2");
                                   $(this).find(".ying_z").html("显示"); 
                                   var id=$(this).siblings(".jc_dbtd_1_left").find("input").attr("id"); 
                                   if( $("#"+id).hasClass("display_1")==true){
                                       $("#"+id).removeClass("display_1");
                                        $("#"+id).addClass("display_0");
                                   }
                                   addToDisplay($("#"+id));
                                   
                                }else{
                                     //显示
                                     var show_len=$(".relative.display_1").length;
                                     var max_len=parseInt($("#span_1").data("max_select_count"));
                                     if(show_len>=max_len){
                                         //打开一个提示框 
                                        // alert('此模版最多可显示'+max_len+'项更多内容，当前内容已超出，请重新选择。');
                                      // alert("此模版已没有位置显示更多的内容，请重新选择！")
                                        appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                       appcan.window.evaluateScript('','uexWindow.alert("提示","此模版已没有位置显示更多内容，请重新选择！","确定");');
                                        return false;
                                     }
                                     $(this).removeClass("color_1_2");
                                     $(this).addClass("color_1_1");
                                     $(this).find(".ying_z").html("隐藏");
                                     var id=$(this).siblings(".jc_dbtd_1_left").find("input").attr("id");
                                     if($("#"+id).hasClass("display_0")==true){
                                         $("#"+id).removeClass("display_0");
                                        $("#"+id).addClass("display_1");
                                   }
                                   removeToDisplay($("#"+id));
                               }
                              refreshLeft(data_1);
                           });       
                       }else{
                           //模版右对齐
                            if(data_1.templateEnName=="forth-template.png" || data_1.templateEnName=="five-template.png"){
                                 $("#img_1111").removeClass("uhide");
                           }
                           for(var i in requiredItems){
                             var each_requiredItem=requiredItems[i];
                               if(each_requiredItem.locateType=="absolute"){
                                   //必须字段的绝对定位
                                  var name=each_requiredItem.key;
                                   var input_val="";
                                   if(name!="company"){
                                          if(name=="userName"){
                                             var userName=$("#userName").val();
                                             if(userName.length==2){
                                                 input_val=userName.substring(0,1)+"　"+userName.substring(1,2);
                                                 // $("#userName_model").html(userName_model);
                                             }else{
                                                input_val=$("#"+name).val();  
                                              }
                                         }else{
                                              input_val=$("#"+name).val();
                                         }
                                     }else{
                                          var inputFormat=data_1.companyConfig.inputFormat;
                                         if($("#addForm").data("is_internal")=="0"){
                                               input_val=$("#"+name).val();
                                        }else if($("#addForm").data("is_internal")=="1"){
                                           input_val=$("#company_select").siblings(".text").html();
                                        }
                                     }
                                   array.push(name); 
                                   if(name!="company"){
                                         $("#"+name).addClass("required");
                                          $("#"+name).addClass("absolute");
                                           $("#"+name).attr("maxlength",each_requiredItem.maxLength);
                                         if(each_requiredItem.text != ""){
                                           //当text不为空时
                                            var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                            var text_top=Number(each_requiredItem.textY)*100;
                                            //var html_1='<div style="position: absolute;top:'+text_top+'%;left:'+text_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<span id="'+name+'_model" style="position: absolute"></span></div>';
                                             var text_right=Number(1-each_requiredItem.textX)*100;
                                              var html_1='<div style="position: absolute;top:'+text_top+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                                   <div class="ub">\
                                                        <div class="ub-f1"></div>\
                                                        <div class="real" >'+each_requiredItem.text+'<span id="'+name+'_model">'+input_val+'</span></div>\
                                                        <div style="width:'+text_right+'%" class="role">\
                                                        </div>\
                                                    </div>\
                                                </div>';
                                              $("#span_1").append(html_1);
                                              if(name=="userName"){
                                                 $("#userName_1").addClass("user-font");
                                             }
                                            
                                        }else{
                                             //当text为空时
                                            var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                            var value_top=Number(each_requiredItem.valueY)*100;
                                            //var html_1='<div style="position: absolute;top:'+value_top+'%;left:'+value_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<div id="'+name+'_model"></div></div>';
                                            var text_right=Number(1-each_requiredItem.valueX)*100;
                                            var html_1='<div style="position: absolute;top:'+value_top+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                               <div class="ub">\
                                                    <div class="ub-f1"></div>\
                                                    <div class="real">'+each_requiredItem.text+'<span id="'+name+'_model">'+input_val+'</span></div>\
                                                    <div style="width:'+text_right+'%" class="role">\
                                                    </div>\
                                                </div>\
                                            </div>';
                                            $("#span_1").append(html_1);
                                              if(name=="userName"){
                                                 $("#userName_1").addClass("user-font");
                                             }
                                        }
                                   }else{
                                       if($("#addForm").data("is_internal")=="0"){
                                           $("#company").addClass("required");
                                           $("#company").addClass("absolute");
                                       }else if($("#addForm").data("is_internal")=="1"){
                                           $("#company_select").addClass("required");
                                            $("#company_select").addClass("absolute");
                                       }
                                           if(each_requiredItem.text != ""){
                                           //当text不为空时
                                            var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                            var text_top=Number(each_requiredItem.textY)*100;
                                            //var html_1='<div style="position: absolute;top:'+text_top+'%;left:'+text_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<span id="'+name+'_model" style="position: absolute"></span></div>';
                                             var text_right=Number(1-each_requiredItem.textX)*100;
                                              var html_1='<div style="position: absolute;top:'+text_top+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                                   <div class="ub">\
                                                        <div class="ub-f1"></div>\
                                                        <div class="real" >'+each_requiredItem.text+'<span id="'+name+'_model">'+input_val+'</span></div>\
                                                        <div style="width:'+text_right+'%" class="role">\
                                                        </div>\
                                                    </div>\
                                                </div>';
                                              $("#span_1").append(html_1);
                                            
                                        }else{
                                             //当text为空时
                                            var fontSize=Number(each_requiredItem.fontSize)/ 1063 * $(".ub-img1").width();
                                            var value_top=Number(each_requiredItem.valueY)*100;
                                            //var html_1='<div style="position: absolute;top:'+value_top+'%;left:'+value_left+'%;font-size:'+fontSize+'px" id="'+name+'_1">'+each_requiredItem.text+'<div id="'+name+'_model"></div></div>';
                                            var text_right=Number(1-each_requiredItem.valueX)*100;
                                            var html_1='<div style="position: absolute;top:'+value_top+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                               <div class="ub">\
                                                    <div class="ub-f1"></div>\
                                                    <div class="real">'+each_requiredItem.text+'<span id="'+name+'_model">'+input_val+'</span></div>\
                                                    <div style="width:'+text_right+'%" class="role">\
                                                    </div>\
                                                </div>\
                                            </div>';
                                            $("#span_1").append(html_1);
                                        }
                                   }
                                
                               }else{
                                   //必须字段的相对定位
                                   if(name!="company"){
                                        var name=each_requiredItem.key;
                                        $("#"+name).addClass("required");
                                       $("#"+name).addClass("relative");
                                        $("#"+name).attr("maxlength",each_requiredItem.maxLength);
                                   }else{
                                          if($("#addForm").data("is_internal")=="0"){
                                                $("#company").addClass("required");
                                                $("#company").addClass("relative");  
                                        }else if($("#addForm").data("is_internal")=="1"){
                                             $("#company_select").addClass("required");
                                              $("#company_select").addClass("absolute");
                                            
                                         }
                                   }
                                   
                                   
                                    
                                  
                                   
                               }
                             }
                             for(var j in selectedItems){
                                 var relative_item=selectedItems[j];
                                  var name=relative_item.key;
                                  if(name=="QQ"){
                                      relative_item.text="Q&nbsp;&nbspQ : ";
                                   }
                                   $("#"+name).addClass("relative");
                                   $("#"+name).attr("maxlength",relative_item.maxLength);
                             }
                            //relative----start
                           refreshRight(data_1);
                               
                            //relative-end
                             //非必须，相对定位
                           var arr_w=new Array();
                           //relative右对齐的失去焦点事件
                           $(".relative").on("blur",function (){
                                 //右对齐的属性显示
                               refreshRight(data_1);
                            })
                            
                            
                            
                            //点击显示，隐藏按钮
                           $(".yingc").on("tap",function (){
                               if($(this).hasClass("color_1_1")==true){
                                   //若颜色为蓝色，则点击将其隐藏
                                   $(this).removeClass("color_1_1");
                                   $(this).addClass("color_1_2");
                                   $(this).find(".ying_z").html("显示"); 
                                   var id=$(this).siblings(".jc_dbtd_1_left").find("input").attr("id"); 
                                   if( $("#"+id).hasClass("display_1")==true){
                                       $("#"+id).removeClass("display_1");
                                        $("#"+id).addClass("display_0");
                                   }
                                     addToDisplay($("#"+id));
                                   
                                }else{
                                     //显示
                                     var show_len=$(".relative.display_1").length;
                                     var max_len=parseInt($("#span_1").data("max_select_count"));
                                     if(show_len>=max_len){
                                         //打开一个提示框 
                                         //alert('此模版最多可显示'+max_len+'项更多内容，当前内容已超出，请重新选择。');
                                        // alert("此模版已没有位置显示更多的内容，请重新选择！")
                                           appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                           appcan.window.evaluateScript('','uexWindow.alert("提示","此模版已没有位置显示更多内容，请重新选择！","确定");');
                                        return false;
                                     }
                                     $(this).removeClass("color_1_2");
                                     $(this).addClass("color_1_1");
                                     $(this).find(".ying_z").html("隐藏");
                                     var id=$(this).siblings(".jc_dbtd_1_left").find("input").attr("id");
                                     if($("#"+id).hasClass("display_0")==true){
                                         $("#"+id).removeClass("display_0");
                                        $("#"+id).addClass("display_1");
                                   }
                                    removeToDisplay($("#"+id));
                               }
                               //右对齐的属性显示
                               refreshRight(data_1);
                           }); 
                       }
                      
                     }
               }
            }
            view.ajax(option);

        }
        //填写时若超出
         $("input").on("focus",function (){
                var relative_len=$("#span_2").children().length;
                 var max_len=parseInt($("#span_1").data("max_select_count"));
                  if($(this).val().length==0){
                      if(relative_len>=max_len){
                      if($(this).hasClass("relative")==true){
                          //confirm("此模版已没有位置显示更多内容，请重新选择！");
                          //alert("此模版已没有位置显示更多内容，请重新选择！");
                          appcan.window.evaluateScript("","window.scrollTo(0,0)");
                          appcan.window.evaluateScript('','uexWindow.alert("提示","此模版已没有位置显示更多内容，请重新选择！","确定");');
                          $(this).blur();
                          return false;
                      }
                     }
                  }
                  
          });
             //当输入框输入时，在模版上显示输入的值
       function copyByInput(obj){

           var i=0;
           var k=$("#more_info_2 input").index($("#"+obj.id));
           var maxLength=$("#"+obj.id).attr("maxlength");
           if( $("#"+obj.id).attr("type")=="number"){
                limit(obj,maxLength);//XX字节内
           }
           $("#"+obj.id+"_model").html(obj.value);
          if( $("#"+obj.id).val().length==0){
               $("#"+obj.id+"_1").addClass("uhide");
                if($("#"+obj.id).hasClass("display_1")==true){
                          $("#"+obj.id).removeClass("display_1");
                          $("#"+obj.id).addClass("display_0");
               }else{
                   $("#"+obj.id).addClass("display_0");
               }
               $("#"+obj.id).parent().siblings(".yingc").addClass("uhide");
               $("#"+obj.id).parent().siblings(".yingc").removeClass("color_1_1");
               $("#"+obj.id).parent().siblings(".yingc").addClass("color_1_2");
               $("#"+obj.id).parent().siblings(".yingc").find(".ying_z").html("显示"); 
             
          }else{
               if($("#"+obj.id+"_1").hasClass("uhide")==true){
                  $("#"+obj.id+"_1").removeClass("uhide")
              }
              if($("#"+obj.id).hasClass("required")==false){
                 if($("#"+obj.id).hasClass("display_0")==true){
                  $("#"+obj.id).removeClass("display_0");
                  $("#"+obj.id).addClass("display_1");
                 }else{
                   $("#"+obj.id).addClass("display_1");
                 }
               
               $("#"+obj.id+"_1").removeClass("uhide");
               $("#"+obj.id).parent().siblings(".yingc").removeClass("uhide");
               $("#"+obj.id).parent().siblings(".yingc").removeClass("color_1_2");
               $("#"+obj.id).parent().siblings(".yingc").addClass("color_1_1");
               $("#"+obj.id).parent().siblings(".yingc").find(".ying_z").html("隐藏");               
              }else{
                  if($("#"+obj.id).hasClass("display_0")==true){
                  $("#"+obj.id).removeClass("display_0");
                  $("#"+obj.id).addClass("display_1");
                 }else{
                   $("#"+obj.id).addClass("display_1");
                 } 
              }
          }
       
       
       }
       
         $("#userName").on("blur",function (){
           var userName=$(this).val();
           if(userName.length==2){
              var userName_model=userName.substring(0,1)+"　"+userName.substring(1,2);
              $("#userName_model").html(userName_model);
           }
          if($("#templateEnName").val()=="first-template.png"){
                 if(userName.length==2||userName.length==3){
                      var per_userName_width=$("#userName_model").width()/4;
                      var each_width=per_userName_width/$(".ub-img1").width();
                     var start_job_left=$("#span_1").data("job_left");
                     var present_job_left=Number(start_job_left)-each_width;
                      $("#span_1").data("percent_job_left",present_job_left);
                 }else{
                     var start_job_left=$("#span_1").data("job_left");
                     var present_job_left=Number(start_job_left);
                     $("#span_1").data("percent_job_left",present_job_left);
                 }
                  if($("#span_1").data("percent_job_left")!=undefined){
                        var percent_job_left=Number($("#span_1").data("percent_job_left"))*100;  
                        $("#job_1").css("left",percent_job_left+"%");
                    }
           }
       });

       
       function saveEditCard(action,userId){
         var arr= serializeJson($("#addForm"));
        
         var url="bcard/updateUserBcard";
        
         arr.userId=userId;
        var option={
               url : url,
              data:arr,
              success:function (data){
                if(data.status=="0"&& data.msg=="更新名片成功"){
			  	window.localStorage.removeItem('uuid_11');
                    window.localStorage.setItem('uuid_11',data.uuid);
                    appcan.window.evaluateScript("","window.scrollTo(0,0)");
                    appcan.locStorage.setVal('bcard_share',data);
                    uexWindow.closePopover("refresh");
                     appcan.window.evaluateScript({
                            name:'cardEdit',
                            scriptContent:'renderSave()'
                      });
                      addWeinxinBcardAction("编辑名片页面","保存"); 
                }else{
                      uexWindow.closePopover("refresh");
                     // alert("数据有误，请重新尝试或联系管理员!");
                     appcan.window.evaluateScript("","window.scrollTo(0,0)");
                     appcan.window.evaluateScript('','uexWindow.alert("提示","数据有误，请重新尝试或联系管理员!","确定");');
                }
              },
              fail:function (){
                   uexWindow.closePopover("refresh");
                  //  alert("请求失败");
                   appcan.window.evaluateScript("","window.scrollTo(0,0)");
                   appcan.window.evaluateScript('','uexWindow.alert("提示","网络异常，请重新尝试或联系管理员!","确定");');
              },
              error:function (){
                   uexWindow.closePopover("refresh");
                   // alert("请求失败");
                    appcan.window.evaluateScript("","window.scrollTo(0,0)");
                   appcan.window.evaluateScript('','uexWindow.alert("提示","请求失败，请重新尝试或联系管理员!","确定");');
              },
              timeout:30000
         }
         appcan.window.evaluateScript({
                name:'',
                scriptContent:'renderRefresh()'
          });
          view.ajax(option);  
       }
       
       function previewCard(action,userId,view_index){
         var arr= serializeJson($("#addForm"));
         var url="";
        if(action!=""){
           arr.action=action; 
           url="bcard/createUserBcard";
        }
         arr.userId=userId;
        var option={
              url : url,
              data:arr,
              success:function (data){
                  //alert("previewCard-->"+ JSON.stringify(data));
                 if(data.status=="0"&& data.msg=="生成预览信息成功"){
                 //打开预览页面
                 $("#uploadresult_1").addClass("uhide");
                  var fileurl=data.fileurl;
                     var backgroundBcardURL=data.backgroundBcardURL;
                     if(view_index==1){
                          appcan.window.evaluateScript({
                                name:'cardEdit',
                                scriptContent:'preview("'+fileurl+'","'+backgroundBcardURL+'");'
                         });
                     }else if(view_index==2){
                         appcan.window.evaluateScript({
                                name:'cardEdit',
                                scriptContent:'preview("'+backgroundBcardURL+'","'+fileurl+'");'
                         });
                     }
                      addWeinxinBcardAction("编辑名片页面","预览名片"); 
                     
                }else{
                    $("#uploadresult_1").addClass("uhide");
                    appcan.window.evaluateScript("","window.scrollTo(0,0)");
                    appcan.window.evaluateScript('','uexWindow.alert("提示","数据有误，请重新尝试或联系管理员!","确定");');
                }
           },
           fail:function (){
             
                $("#uploadresult_1").addClass("uhide");
                //alert("请求失败");
                appcan.window.evaluateScript("","window.scrollTo(0,0)");
                appcan.window.evaluateScript('','uexWindow.alert("提示","网络异常，请重新尝试或联系管理员!","确定");');
          },
          error:function (){
               $("#uploadresult_1").addClass("uhide");
               //  alert("请求失败");
               appcan.window.evaluateScript("","window.scrollTo(0,0)");
               appcan.window.evaluateScript('','uexWindow.alert("提示","请求失败，请重新尝试或联系管理员!","确定");');
          },
            timeout:30000
         }
         $("#uploadresult_1").removeClass("uhide");
          view.ajax(option);
       }
       
        function serializeJson(ID) {
            var serializeObj = {};
            $(ID.serializeArray()).each(function() {
               if($("#"+this.name).hasClass("display_1")==true){
                  this.display="1"; 
               }else{
                    this.display="0"; 
                    
               }
               if(this.name=="bcardName"){
                  
                   serializeObj[this.name]=this.value;
               }else if(this.name=="templateId"){
                      serializeObj[this.name]=this.value;
               }else if(this.name=="company"){
                   if($("#company_select").parents(".jc_flex").hasClass("uhide")==false){
                       if($("#company_select").hasClass("display_1")==true){
                           this.display="1";
                       }else{
                           this.display="0";
                       }
                       if($("#company_select").siblings(".text").html()=="请选择"){
                              this.value="";
                        }else{
                               this.value=$("#company_select").siblings(".text").html();
                       }
                       serializeObj["company"]= {"value":this.value,"display":this.display};
                   }else{
                       if($("#company").parents(".jc_flex").hasClass("uhide")==false){
                          if($("#company").hasClass("display_1")==true){
                               this.display="1";
                           }else{
                               this.display="0";
                           }
                          serializeObj["company"]= {"value":this.value,"display":this.display};
                       }else{
                            serializeObj["company"]= {"value":"","display":"0"};
                       }
                   }
               }else if(this.name=="bcardId"){
                   serializeObj[this.name]=this.value ;
               }else if(this.name=="templateEnName"){
                    serializeObj[this.name]=this.value ;
               }else{
                   serializeObj[this.name] = {"value":this.value,"display":this.display,"enabled":this.enabled,"text_left":this.text_left};
               }
                
            });
            return serializeObj;
        };

       $("#bannerList").on("swipeLeft swipeRight",function (){
           $("input").blur();
       });
       
       //根据所在input的id去除隐藏
       function removeToDisplay(ID){
            ID.parent().removeClass("input_1");
            ID.parent().addClass("input_2");
            ID.parent().siblings(".jc_dbtd_left").removeClass("ai-ph-ucommon");
            ID.parent().siblings(".jc_dbtd_left").addClass("ai-ph-display");
           ID.removeAttr("readonly");
       }
        //根据所在input的id隐藏该行
       function addToDisplay(ID){
           ID.parent().removeClass("input_2");
           ID.parent().addClass("input_1");
           ID.parent().siblings(".jc_dbtd_left").removeClass("ai-ph-display");
           ID.parent().siblings(".jc_dbtd_left").addClass("ai-ph-ucommon");
           ID.attr("readonly",true);
       }
       slider.on("clickItem",function(index,data){
             var  action="view";
             var userId=$("#addForm").data("user_id");
            if(validate()==false){
                return;
            }else{
              if(index==0){
               // saveCard(action,userId,"",1);  
                previewCard(action,userId,1);
               }else{

                  previewCard(action,userId,2);
               }
            }                
        }) 
            // 获取字符串的字节长度
            function len(s) {
                s = String(s);
                return s.length + (s.match(/[^\x00-\xff]/g) || "").length;// 加上匹配到的全角字符长度
            }
            function limit(obj, limit) {
               
                var val = obj.value;
                if (len(val) > limit) {
                    val=val.substring(0,limit);
                    while (len(val) > limit){
                      val = val.substring(0, val.length - 1);
                    };
                    obj.value = val;
                }
            }
            //输入验证
             // $("input").on("blur",function (){
               // if($(this).val().length>0){
                   // if($(this).attr("id")!="company_select"){
                     // var eachVal=$(this).val();
//                        
                      // var reg = $(this).attr("regex");
                    // if(typeof(reg) != "undefined" && reg != null){
                    // var patt = new RegExp(reg);
                    // if(!patt.test(eachVal)){
//                     
                       // appcan.window.evaluateScript("","window.scrollTo(0,0)");
                         // var toastStr = $(this).attr("errorMsg");
                        // appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                       // $(this).focus();
//                   
                        // return false;
                    // }
                   // }
                 // } 
               // }
        // });
            //验证
            function validate(){
                      var flag = true;
                     //当模版显示内容大于7时
                     var show_len=$(".relative.display_1").length;
                     var max_len=parseInt($("#span_1").data("max_select_count"));
                     if(show_len>max_len){
                         //打开一个提示框 
                       //  alert('此模版最多可显示'+max_len+'项更多内容，当前内容已超出，请重新选择。');
                        // alert("此模版已没有位置显示更多的内容，请重新选择！")
                          appcan.window.evaluateScript("","window.scrollTo(0,0)");
                          appcan.window.evaluateScript('','uexWindow.alert("提示","此模版已没有位置显示更多内容，请重新选择！","确定");');
                        
                         flag = !flag;
                        return false;
                     }
                    
                    for(var i=0;i<$(".display_1").length;i++){
                         if($(".display_1").eq(i).attr("id")!="company_select"){
                             var eachVal=$(".display_1").eq(i).val();
                               if(eachVal==""){
                                appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                var toastStr = $(".display_1").eq(i).attr("placeholder");
                                appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                             flag = !flag;
                              return false;
                              }
                              // var reg = $(".display_1").eq(i).attr("regex");
//                     
                            // if(typeof(reg) != "undefined" && reg != null){
                            // var patt = new RegExp(reg);
                            // if(!patt.test(eachVal)){
                                // flag = !flag;
                               // appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                 // var toastStr = $(".display_1").eq(i).attr("errorMsg");
                                // appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                                // return false;
                            // }
                           // }
                         }else{
                            
                             var company_select_val= $("#company_model").html();;
                             if(company_select_val==""){
                                  appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                //  appcan.window.openToast($("#company_select").attr("placeholder"),3000,5,0);
                                 var toastStr =$("#company_select").attr("placeholder");
                                appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                                flag = !flag;
                                return false;
                             }
                         }
                       
                        
                     }
                     for(var j=0;j<$(".required").length;j++){
                             if($(".required").eq(j).attr("id")!="company_select"){
                             var eachVal=$(".required").eq(j).val();
                               if(eachVal==""){
                                appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                var toastStr = $(".required").eq(j).attr("placeholder");
                                appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                             flag = !flag;
                              return false;
                              }
                              // var reg = $(".required").eq(j).attr("regex");
//                     
                            // if(typeof(reg) != "undefined" && reg != null){
                            // var patt = new RegExp(reg);
                            // if(!patt.test(eachVal)){
                                // flag = !flag;
                               // appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                 // var toastStr = $(".required").eq(j).attr("errorMsg");
                                // appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                                // return false;
                            // }
                           // }
                         }else{
                            
                             var company_select_val= $("#company_model").html();;
                             if(company_select_val==""){
                                  appcan.window.evaluateScript("","window.scrollTo(0,0)");
                                //  appcan.window.openToast($("#company_select").attr("placeholder"),3000,5,0);
                                 var toastStr =$("#company_select").attr("placeholder");
                                appcan.window.evaluateScript('','appcan.window.openToast("'+toastStr+'",3000,5,0)');
                                flag = !flag;
                                return false;
                             }
                         }
                     }
               if(!flag)return; 
            }
            function refreshLeft(data_1){
                 var starTextX= $("#span_1").data("start_text_x");
                  var startLocConfig=data_1.startLocationConfig;
                 var incY=startLocConfig.incrementY*100;
                 var startTextY= startLocConfig.startTextY*100;
                var requiredItems=data_1.requiredItems;
              var selectedItems=data_1.selectedItems;
                var html_2="";
                   var item_display=-1;
                   var length=$(".relative").length;
                   for(var i=0;i<length;i++){
                       var input_val=$(".relative").eq(i).val();       
                           var id=$(".relative").eq(i).attr("id");
                          if($("#"+id).val().length>0){
                              if($("#"+id).hasClass("display_1")==true){
                                     if($("#"+id).hasClass("required")==true){
                                   for(var j in requiredItems){
                                       var show_Item=requiredItems[j];
                                       var name=show_Item.key;
                                       if(id==name){
                                            item_display++;
                                            var startTextY=$("#span_1").data("start_text_y");
                                            var startTextY=Number(startTextY)+Number(incY)*item_display;
                                            var value=$("#"+id).val();
                                          var fontSize=$("#span_1").data("font_size");
                                          if(show_Item.text!=""){
                                              html_2+='<div style="position: absolute;left:'+starTextX+'%;font-size:'+fontSize+'px;top:'+startTextY+'%" id="'+id+'_1" >'+show_Item.text+'<span id="'+id+'_model" style="">'+value+'</span></div>';
                                          }else{
                                               html_2+='<div style="position: absolute;left:'+starTextX+'%;font-size:'+fontSize+'px;top:'+startTextY+'%" id="'+id+'_1"><span id="'+id+'_model" style=""></span>'+value+'</div>';
                                          }
                                         
                                       }
                                   }
                              }else{
                                  for(var j in selectedItems){
                                       var show_Item=selectedItems[j];
                                       var name=show_Item.key;
                                       if(id==name){
                                              $("#"+id).parent().siblings(".yingc").removeClass("uhide");
                                                   $("#"+id).parent().siblings(".yingc").removeClass("color_1_2");
                                                   $("#"+id).parent().siblings(".yingc").addClass("color_1_1");
                                                   $("#"+id).parent().siblings(".yingc").find(".ying_z").html("隐藏"); 
                                               removeToDisplay($("#"+id));
                                           item_display++;
                                            var startTextY=$("#span_1").data("start_text_y");
                                            var startTextY=Number(startTextY)+Number(incY)*item_display;
                                          var fontSize=$("#span_1").data("font_size");
                                           var value=$("#"+id).val();
                                          if(show_Item.text!=""){
                                              html_2+='<div style="position: absolute;left:'+starTextX+'%;font-size:'+fontSize+'px;top:'+startTextY+'%" id="'+id+'_1" >'+show_Item.text+'<span id="'+id+'_model" style="">'+value+'</span></div>';
                                          }else{
                                               html_2+='<div style="position: absolute;left:'+starTextX+'%;font-size:'+fontSize+'px;top:'+startTextY+'%" id="'+id+'_1"><span id="'+id+'_model" style="">'+value+'</span></div>';
                                          }
                                         
                                       }
                                       
                                   }
                              } 
                              }else{
                                  for(var j in selectedItems){
                                       var show_Item=selectedItems[j];
                                       var name=show_Item.key;
                                       if(id==name){
                                            addToDisplay( $("#"+id));
                                         // $("#"+id).attr("readonly",true);
                                         $("#"+id).parent().siblings(".yingc").removeClass("uhide");
                                          addToDisplay( $("#"+id));
                                       }
                                       
                                   }
                              }
                           
                          }
                           
                       
                   }
                   $("#span_2").html(html_2);
            }
        function refreshRight(data_1){
                 var starTextX= $("#span_1").data("start_text_x");
                 var startLocConfig=data_1.startLocationConfig;
                var incY=startLocConfig.incrementY*100;
                var startTextY= startLocConfig.startTextY*100;
                var requiredItems=data_1.requiredItems;
                var selectedItems=data_1.selectedItems;
                 var html_2="";
               var item_display=-1;
               var length=$(".relative").length;
               for(var i=0;i<length;i++){
                   var input_val=$(".relative").eq(i).val();       
                       var id=$(".relative").eq(i).attr("id");
                      if($("#"+id).val().length>0){
                          if($("#"+id).hasClass("display_1")==true){
                           if($("#"+id).hasClass("required")==true){
                               for(var j in requiredItems){
                                   var show_Item=requiredItems[j];
                                   var name=show_Item.key;
                                   if(id==name){
                                        item_display++;
                                        var startTextY=$("#span_1").data("start_text_y");
                                        var startTextY=Number(startTextY)+Number(incY)*item_display;
                                        var value=$("#"+id).val();
                                      var fontSize=$("#span_1").data("font_size");
                                      if(show_Item.text!=""){

                                            //var text_right=28.000000000000004;
                                             var text_right=100-Number($("#span_1").data("start_text_x"));
                                          html_2+='<div style="position: absolute;top:'+startTextY+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                                   <div class="ub">\
                                                        <div class="ub-f1"></div>\
                                                        <div class="real">'+show_Item.text+'<span id="'+name+'_model">'+value+'</span></div>\
                                                        <div style="width:'+text_right+'%" class="role">\
                                                        </div>\
                                                    </div>\
                                                </div>';
                                      }else{  
                                           var text_right=100-Number($("#span_1").data("start_text_x"));
                                          html_2+='<div style="position: absolute;top:'+startTextY+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1" >\
                                                   <div class="ub">\
                                                        <div class="ub-f1"></div>\
                                                        <div class="real"><span id="'+name+'_model">'+value+'</span></div>\
                                                        <div style="width:'+text_right+'%" class="role">\
                                                        </div>\
                                                    </div>\
                                                </div>';
                                      }
                                     
                                   }
                               }
                          }else{
                              for(var j in selectedItems){
                                   var show_Item=selectedItems[j];
                                   var name=show_Item.key;
                                   if(id==name){
                                       $("#"+id).parent().siblings(".yingc").removeClass("uhide");
                                       $("#"+id).parent().siblings(".yingc").removeClass("color_1_2");
                                       $("#"+id).parent().siblings(".yingc").addClass("color_1_1");
                                       $("#"+id).parent().siblings(".yingc").find(".ying_z").html("隐藏"); 
                                        removeToDisplay($("#"+id));
                                        item_display++;
                                     
                                        var startTextY=$("#span_1").data("start_text_y");
                                        var startTextY=Number(startTextY)+Number(incY)*item_display;
                                   
                                      var fontSize=$("#span_1").data("font_size");
                                       var value=$("#"+id).val();
                                      if(show_Item.text!=""){
                                             var valueX=Number($("#img_1111").css("left").substring(0,$("#img_1111").css("left").length-1))/100;
                                            
                                             var text_right=100-Number($("#span_1").data("start_text_x"));
                                            html_2+='<div style="position: absolute;top:'+startTextY+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                               <div class="ub">\
                                                    <div class="ub-f1"></div>\
                                                    <div class="real">'+show_Item.text+'<span id="'+name+'_model">'+value+'</span></div>\
                                                    <div style="width:'+text_right+'%" class="role">\
                                                    </div>\
                                                </div>\
                                            </div>';
                                         // html_2+='<div style="position: absolute;left:'+starTextX+'%;font-size:'+fontSize+'px;top:'+startTextY+'%" id="'+id+'_1" >'+show_Item.text+'<span id="'+id+'_model" style="">'+value+'</span></div>';
                                      }else{
                                        
                                          var text_right=100-Number($("#span_1").data("start_text_x"));
                                          html_2+='<div style="position: absolute;top:'+startTextY+'%;width: 100%;font-size:'+fontSize+'px" id="'+name+'_1">\
                                           <div class="ub">\
                                                <div class="ub-f1"></div>\
                                                <div class="real" >'+show_Item.text+'<span id="'+name+'_model">'+value+'</span></div>\
                                                <div style="width:'+text_right+'%" class="role">\
                                                </div>\
                                            </div>\
                                         </div>';
                                          // html_2+='<div style="position: absolute;left:'+starTextX+'%;font-size:'+fontSize+'px;top:'+startTextY+'%" id="'+id+'_1"><span id="'+id+'_model" style="">'+value+'</span></div>';
                                      }
                                     
                                   }
                                   
                               }
                          }
                          }else{
                              for(var j in selectedItems){
                                   var show_Item=selectedItems[j];
                                   var name=show_Item.key;
                                   if(id==name){
                                        $("#"+id).parent().siblings(".yingc").removeClass("uhide");
                                    addToDisplay( $("#"+id)); 
                                   }
                                   
                               }
                          }
                       
                      }
               }
               $("#span_2").html(html_2);
               
            }

 </script>
</html>
